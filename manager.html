<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Client Manager — Gardners Ground Maintenance</title>
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="css/style.css">
    <!-- SheetJS for Excel export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
    <script src="js/admin-auth.js"></script>
</head>
<body style="display:none">

    <!-- Admin Header -->
    <header class="header">
        <div class="container">
            <a href="index.html" class="logo">
                <i class="fas fa-leaf"></i>
                Gardners Ground Maintenance
            </a>
            <div class="mgr-header-right">
                <a href="admin.html" class="btn btn-sm btn-outline-green"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                <a href="admin.html#careers" onclick="localStorage.setItem('adminTab','panelCareers')" class="btn btn-sm btn-outline-green"><i class="fas fa-user-tie"></i> Post Jobs</a>
                <a href="invoice.html" class="btn btn-sm btn-outline-green"><i class="fas fa-file-invoice-pound"></i> Invoice</a>
                <div class="invoice-admin-badge"><i class="fas fa-lock"></i> Client Manager</div>
            </div>
        </div>
    </header>

    <!-- Manager Content -->
    <section class="mgr-section">
        <div class="container">

            <!-- Top Stats -->
            <div class="mgr-stats-row">
                <div class="mgr-stat">
                    <i class="fas fa-users"></i>
                    <div>
                        <span class="mgr-stat-val" id="mgrStatTotal">—</span>
                        <span class="mgr-stat-label">Total Records</span>
                    </div>
                </div>
                <div class="mgr-stat">
                    <i class="fas fa-calendar-check"></i>
                    <div>
                        <span class="mgr-stat-val" id="mgrStatBookings">—</span>
                        <span class="mgr-stat-label">Bookings</span>
                    </div>
                </div>
                <div class="mgr-stat">
                    <i class="fas fa-sync-alt"></i>
                    <div>
                        <span class="mgr-stat-val" id="mgrStatSubs">—</span>
                        <span class="mgr-stat-label">Subscriptions</span>
                    </div>
                </div>
                <div class="mgr-stat">
                    <i class="fas fa-pound-sign"></i>
                    <div>
                        <span class="mgr-stat-val" id="mgrStatPaid">—</span>
                        <span class="mgr-stat-label">Paid</span>
                    </div>
                </div>
                <div class="mgr-stat">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <span class="mgr-stat-val" id="mgrStatUnpaid">—</span>
                        <span class="mgr-stat-label">Unpaid</span>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="mgr-controls">
                <div class="mgr-search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="mgrSearch" placeholder="Search by name, email, postcode, service...">
                </div>
                <div class="mgr-filters">
                    <select id="mgrFilterType">
                        <option value="">All Types</option>
                        <option value="booking">Bookings</option>
                        <option value="subscription">Subscriptions</option>
                        <option value="stripe-subscription">Stripe Subscriptions</option>
                        <option value="booking-payment">Paid Bookings</option>
                        <option value="stripe-invoice">Invoices</option>
                    </select>
                    <select id="mgrFilterStatus">
                        <option value="">All Status</option>
                        <option value="Active">Active</option>
                        <option value="succeeded">Paid / Succeeded</option>
                        <option value="Sent">Invoice Sent</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <select id="mgrFilterPaid">
                        <option value="">All Payments</option>
                        <option value="Yes">Paid</option>
                        <option value="No">Unpaid</option>
                        <option value="Auto">Auto (Subscription)</option>
                    </select>
                </div>
                <div class="mgr-actions">
                    <button class="btn btn-primary btn-sm" id="mgrRefreshBtn"><i class="fas fa-sync-alt"></i> Refresh</button>
                    <button class="btn btn-outline-green btn-sm" id="mgrExportBtn"><i class="fas fa-file-excel"></i> Export</button>
                </div>
            </div>

            <!-- Loading state -->
            <div id="mgrLoading" class="mgr-loading">
                <i class="fas fa-spinner fa-spin"></i> Loading clients from Google Sheets...
            </div>

            <!-- Client cards / table -->
            <div id="mgrClientList" class="mgr-client-list" style="display:none;"></div>

            <!-- Empty state -->
            <div id="mgrEmpty" class="mgr-empty" style="display:none;">
                <i class="fas fa-inbox"></i>
                <p>No records found</p>
            </div>

        </div>
    </section>

    <!-- Client Detail Modal -->
    <div class="mgr-modal-overlay" id="mgrModal" style="display:none;">
        <div class="mgr-modal">
            <div class="mgr-modal-header">
                <h3 id="mgrModalTitle"><i class="fas fa-user"></i> Client Details</h3>
                <button class="mgr-modal-close" id="mgrModalClose">&times;</button>
            </div>
            <div class="mgr-modal-body">
                <input type="hidden" id="mgrRowIndex">

                <!-- Client Info Section -->
                <div class="mgr-detail-section">
                    <h4><i class="fas fa-user"></i> Client Info</h4>
                    <div class="mgr-form-row">
                        <div class="mgr-form-group">
                            <label>Name</label>
                            <input type="text" id="mgrName">
                        </div>
                        <div class="mgr-form-group">
                            <label>Email</label>
                            <input type="email" id="mgrEmail">
                        </div>
                    </div>
                    <div class="mgr-form-row">
                        <div class="mgr-form-group">
                            <label>Phone</label>
                            <input type="tel" id="mgrPhone">
                        </div>
                        <div class="mgr-form-group">
                            <label>Postcode</label>
                            <input type="text" id="mgrPostcode">
                        </div>
                    </div>
                    <div class="mgr-form-group">
                        <label>Address</label>
                        <input type="text" id="mgrAddress">
                    </div>
                </div>

                <!-- Booking/Service Section -->
                <div class="mgr-detail-section">
                    <h4><i class="fas fa-leaf"></i> Service Details</h4>
                    <div class="mgr-form-row">
                        <div class="mgr-form-group">
                            <label>Service / Package</label>
                            <input type="text" id="mgrService">
                        </div>
                        <div class="mgr-form-group">
                            <label>Price</label>
                            <input type="text" id="mgrPrice">
                        </div>
                    </div>
                    <div class="mgr-form-row">
                        <div class="mgr-form-group">
                            <label>Date</label>
                            <input type="text" id="mgrDate">
                        </div>
                        <div class="mgr-form-group">
                            <label>Time</label>
                            <input type="text" id="mgrTime">
                        </div>
                    </div>
                    <div class="mgr-form-row">
                        <div class="mgr-form-group">
                            <label>Preferred Day</label>
                            <select id="mgrDay">
                                <option value="">—</option>
                                <option value="Monday">Monday</option>
                                <option value="Tuesday">Tuesday</option>
                                <option value="Wednesday">Wednesday</option>
                                <option value="Thursday">Thursday</option>
                                <option value="Friday">Friday</option>
                                <option value="Saturday">Saturday</option>
                            </select>
                        </div>
                        <div class="mgr-form-group">
                            <label>Type</label>
                            <input type="text" id="mgrType" readonly>
                        </div>
                    </div>
                </div>

                <!-- Status Section -->
                <div class="mgr-detail-section">
                    <h4><i class="fas fa-tasks"></i> Status & Payment</h4>
                    <div class="mgr-form-row">
                        <div class="mgr-form-group">
                            <label>Status</label>
                            <select id="mgrStatus">
                                <option value="Active">Active</option>
                                <option value="succeeded">Paid / Completed</option>
                                <option value="Sent">Invoice Sent</option>
                                <option value="Pending">Pending</option>
                                <option value="Cancelled">Cancelled</option>
                                <option value="Completed">Job Completed</option>
                            </select>
                        </div>
                        <div class="mgr-form-group">
                            <label>Paid?</label>
                            <select id="mgrPaid">
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                                <option value="Auto">Auto (Subscription)</option>
                                <option value="Stripe One-Off">Stripe One-Off</option>
                                <option value="Stripe Recurring">Stripe Recurring</option>
                            </select>
                        </div>
                    </div>
                    <div class="mgr-form-group">
                        <label>Notes</label>
                        <textarea id="mgrNotes" rows="3" placeholder="Access details, gate code, job notes..."></textarea>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="mgr-detail-section">
                    <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
                    <div class="mgr-quick-actions">
                        <button class="btn btn-sm btn-primary" id="mgrSaveBtn"><i class="fas fa-save"></i> Save Changes</button>
                        <button class="btn btn-sm btn-outline-green" id="mgrInvoiceBtn"><i class="fas fa-file-invoice-pound"></i> Create Invoice</button>
                        <button class="btn btn-sm btn-outline-green" id="mgrCallBtn"><i class="fas fa-phone"></i> Call</button>
                        <button class="btn btn-sm btn-outline-green" id="mgrEmailBtn"><i class="fas fa-envelope"></i> Email</button>
                        <button class="btn btn-sm btn-outline-green" id="mgrMapBtn"><i class="fas fa-map-marker-alt"></i> Map</button>
                        <button class="btn btn-sm" id="mgrRescheduleBtn" style="background:#1565C0;color:#fff;"><i class="fas fa-calendar-alt"></i> Reschedule</button>
                        <button class="btn btn-sm" id="mgrCancelBtn" style="background:#e53935;color:#fff;"><i class="fas fa-ban"></i> Cancel</button>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="mgr-detail-section">
                    <h4><i class="fas fa-history"></i> Record Info</h4>
                    <div class="mgr-record-info">
                        <span id="mgrRecordTimestamp"></span>
                        <span id="mgrRecordDistance"></span>
                        <span id="mgrRecordPayment"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/admin-nav.js"></script>
    <script src="js/main.js"></script>
    <script src="js/distance.js"></script>
    <script src="js/manager.js"></script>
</body>
</html>
