<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Admin Dashboard ‚Äî Gardners Ground Maintenance</title>
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
    <script src="js/admin-auth.js"></script>
    <style>
        .qb-template-btn{background:#fff;border:1px solid #ddd;padding:5px 12px;border-radius:16px;font-size:12px;cursor:pointer;transition:all .15s;white-space:nowrap;}
        .qb-template-btn:hover{background:#1B5E20;color:#fff;border-color:#1B5E20;transform:scale(1.04);}
    </style>
</head>
<body style="display:none">

    <!-- Old header kept for sidebar to remove -->
    <header class="header">
        <div class="container">
            <a href="index.html" class="logo"><i class="fas fa-leaf"></i> Gardners Ground Maintenance</a>
        </div>
    </header>

    <!-- Dashboard -->
    <section class="admin-dashboard">
        <div class="container">

            <h1 class="admin-title"><i class="fas fa-tachometer-alt"></i> Business Dashboard</h1>

            <!-- Enhanced Stats Grid ‚Äî 8 key metrics -->
            <div class="adm-stats-grid">
                <div class="adm-stat-card">
                    <div class="adm-stat-icon green"><i class="fas fa-users"></i></div>
                    <div>
                        <div class="adm-stat-value" id="statClients">0</div>
                        <div class="adm-stat-label">Total Clients</div>
                    </div>
                </div>
                <div class="adm-stat-card">
                    <div class="adm-stat-icon blue"><i class="fas fa-sync-alt"></i></div>
                    <div>
                        <div class="adm-stat-value" id="statSubscribers">0</div>
                        <div class="adm-stat-label">Subscribers</div>
                    </div>
                </div>
                <div class="adm-stat-card">
                    <div class="adm-stat-icon teal"><i class="fas fa-calendar-check"></i></div>
                    <div>
                        <div class="adm-stat-value" id="statBookings">0</div>
                        <div class="adm-stat-label">One-off Bookings</div>
                    </div>
                </div>
                <div class="adm-stat-card">
                    <div class="adm-stat-icon green"><i class="fas fa-check-circle"></i></div>
                    <div>
                        <div class="adm-stat-value" id="statPaid">0</div>
                        <div class="adm-stat-label">Paid</div>
                    </div>
                </div>
                <div class="adm-stat-card">
                    <div class="adm-stat-icon red"><i class="fas fa-exclamation-circle"></i></div>
                    <div>
                        <div class="adm-stat-value" id="statUnpaid">0</div>
                        <div class="adm-stat-label">Unpaid</div>
                    </div>
                </div>
                <div class="adm-stat-card">
                    <div class="adm-stat-icon purple"><i class="fas fa-pound-sign"></i></div>
                    <div>
                        <div class="adm-stat-value" id="statRevenue">¬£0</div>
                        <div class="adm-stat-label">Total Revenue</div>
                    </div>
                </div>
                <div class="adm-stat-card">
                    <div class="adm-stat-icon amber"><i class="fas fa-hourglass-half"></i></div>
                    <div>
                        <div class="adm-stat-value" id="statOutstanding">¬£0</div>
                        <div class="adm-stat-label">Outstanding</div>
                    </div>
                </div>
                <div class="adm-stat-card">
                    <div class="adm-stat-icon teal"><i class="fas fa-route"></i></div>
                    <div>
                        <div class="adm-stat-value" id="statAvgDist">‚Äî</div>
                        <div class="adm-stat-label">Avg Distance</div>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="adm-tab-bar">
                <button class="adm-tab-btn active" data-admin-tab="panelOverview"><i class="fas fa-home"></i> <span>Overview</span></button>
                <button class="adm-tab-btn" data-admin-tab="panelSubscriptions"><i class="fas fa-sync-alt"></i> <span>Subscriptions</span></button>
                <button class="adm-tab-btn" data-admin-tab="panelPayments"><i class="fas fa-credit-card"></i> <span>Payments</span></button>
                <button class="adm-tab-btn" data-admin-tab="panelNewsletter"><i class="fas fa-newspaper"></i> <span>Newsletter</span></button>
                <button class="adm-tab-btn" data-admin-tab="panelTelegram"><i class="fas fa-paper-plane"></i> <span>Telegram</span></button>
                <button class="adm-tab-btn" data-admin-tab="panelEmailWorkflow"><i class="fas fa-envelope-open-text"></i> <span>Email Workflow</span></button>
                <button class="adm-tab-btn" data-admin-tab="panelQuoteBuilder"><i class="fas fa-calculator"></i> <span>Quote Builder</span></button>
                <button class="adm-tab-btn" data-admin-tab="panelShop"><i class="fas fa-shopping-bag"></i> <span>Shop</span></button>
                <button class="adm-tab-btn" data-admin-tab="panelFinance"><i class="fas fa-piggy-bank"></i> <span>Finance</span></button>
                <button class="adm-tab-btn" data-admin-tab="panelCareers"><i class="fas fa-user-tie"></i> <span>Careers</span></button>
                <button class="adm-tab-btn" data-admin-tab="panelComplaints"><i class="fas fa-exclamation-circle"></i> <span>Complaints</span></button>
            </div>

            <!-- ‚îÄ‚îÄ PANEL: Overview ‚îÄ‚îÄ -->
            <div class="adm-tab-panel active" id="panelOverview">

                <!-- üí∞ Financial Snapshot ‚Äî This Month at a Glance -->
                <div class="adm-card" style="margin-bottom:1.5rem; border-left:4px solid #2E7D32;">
                    <h3 style="margin-bottom:1.25rem;"><i class="fas fa-chart-line" style="color:#2E7D32;"></i> Financial Snapshot ‚Äî <span id="finMonth">This Month</span></h3>
                    <div id="finLoading" style="text-align:center;padding:1rem;color:#999;"><i class="fas fa-spinner fa-spin"></i> Calculating financials...</div>
                    <div id="finContent" style="display:none;">
                        <div class="adm-stats-grid" style="margin-bottom:1.25rem;">
                            <div class="adm-stat-card">
                                <div class="adm-stat-icon green"><i class="fas fa-arrow-up"></i></div>
                                <div>
                                    <div class="adm-stat-value" id="finRevenue">¬£0</div>
                                    <div class="adm-stat-label">Revenue</div>
                                </div>
                            </div>
                            <div class="adm-stat-card">
                                <div class="adm-stat-icon red"><i class="fas fa-arrow-down"></i></div>
                                <div>
                                    <div class="adm-stat-value" id="finCosts">¬£0</div>
                                    <div class="adm-stat-label">Total Costs</div>
                                </div>
                            </div>
                            <div class="adm-stat-card">
                                <div class="adm-stat-icon purple"><i class="fas fa-coins"></i></div>
                                <div>
                                    <div class="adm-stat-value" id="finProfit">¬£0</div>
                                    <div class="adm-stat-label">Net Profit</div>
                                </div>
                            </div>
                            <div class="adm-stat-card">
                                <div class="adm-stat-icon blue"><i class="fas fa-percentage"></i></div>
                                <div>
                                    <div class="adm-stat-value" id="finMargin">0%</div>
                                    <div class="adm-stat-label">Profit Margin</div>
                                </div>
                            </div>
                        </div>
                        <!-- Profit vs Cost bar -->
                        <div style="margin-bottom:1rem;">
                            <div style="display:flex;justify-content:space-between;font-size:0.78rem;color:#6b7f93;margin-bottom:0.3rem;">
                                <span>Costs</span>
                                <span>Profit</span>
                            </div>
                            <div style="height:20px;background:#f3f4f6;border-radius:10px;overflow:hidden;display:flex;">
                                <div id="finBarCost" style="background:linear-gradient(90deg,#ef4444,#f97316);height:100%;transition:width 0.6s ease;" title="Costs"></div>
                                <div id="finBarProfit" style="background:linear-gradient(90deg,#22c55e,#16a34a);height:100%;transition:width 0.6s ease;" title="Profit"></div>
                            </div>
                        </div>
                        <!-- Cost breakdown mini -->
                        <div style="display:flex;flex-wrap:wrap;gap:0.75rem;font-size:0.82rem;color:#6b7f93;">
                            <span><i class="fas fa-gas-pump" style="color:#E65100;width:16px;"></i> Fuel: <strong id="finFuel">¬£0</strong></span>
                            <span><i class="fas fa-leaf" style="color:#1B5E20;width:16px;"></i> Materials: <strong id="finMaterials">¬£0</strong></span>
                            <span><i class="fas fa-cog" style="color:#1565C0;width:16px;"></i> Overheads: <strong id="finOverheads">¬£0</strong></span>
                            <span><i class="fas fa-exclamation-triangle" style="color:#E65100;width:16px;"></i> Outstanding: <strong id="finOutstanding">¬£0</strong></span>
                            <span><i class="fas fa-briefcase" style="color:#4527A0;width:16px;"></i> Jobs: <strong id="finJobCount">0</strong></span>
                        </div>
                    </div>
                </div>

                <div class="adm-row">
                    <!-- Recent Activity -->
                    <div class="adm-card">
                        <h3><i class="fas fa-bolt"></i> Recent Activity</h3>
                        <div id="activityFeed">
                            <p class="adm-empty"><i class="fas fa-spinner fa-spin"></i> Loading activity...</p>
                        </div>
                    </div>

                    <!-- Quick Actions + Business Info -->
                    <div>
                        <div class="adm-card">
                            <h3><i class="fas fa-rocket"></i> Quick Actions</h3>
                            <div style="display:flex; flex-direction:column; gap:0.5rem;">
                                <a href="invoice.html" class="btn btn-primary" style="width:100%; text-align:center;"><i class="fas fa-file-invoice-dollar"></i> Create Invoice</a>
                                <a href="profitability.html" class="btn btn-primary" style="width:100%; text-align:center;"><i class="fas fa-chart-pie"></i> Profitability</a>
                                <a href="blog-editor.html" class="btn btn-outline-green" style="width:100%; text-align:center;"><i class="fas fa-pen-fancy"></i> Blog Editor</a>
                                <a href="admin/Gardners_GM_Business_Plan.pdf" download="Gardners_GM_Business_Plan.pdf" class="btn btn-outline-green" style="width:100%; text-align:center;"><i class="fas fa-file-pdf"></i> Download Business Plan</a>
                            </div>
                        </div>
                        <div class="adm-card" style="margin-top:1rem;">
                            <h3><i class="fas fa-info-circle"></i> Business Info</h3>
                            <div style="font-size:0.85rem; color:#6b7f93; line-height:1.8;">
                                <div><i class="fas fa-building" style="width:18px; color:#2E7D32;"></i> Gardners Ground Maintenance</div>
                                <div><i class="fas fa-phone" style="width:18px; color:#2E7D32;"></i> 01726 432051</div>
                                <div><i class="fas fa-envelope" style="width:18px; color:#2E7D32;"></i> info@gardnersgm.co.uk</div>
                                <div><i class="fas fa-map-marker-alt" style="width:18px; color:#2E7D32;"></i> Roche, Cornwall PL26 8HN</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ PANEL: Subscriptions ‚îÄ‚îÄ -->
            <div class="adm-tab-panel" id="panelSubscriptions">

                <!-- Controls Row -->
                <div class="adm-row" style="margin-bottom:1.5rem;gap:1rem;flex-wrap:wrap;">
                    <button class="btn btn-primary" id="btnGenSchedule">
                        <i class="fas fa-magic"></i> Auto-Generate Schedule
                    </button>
                    <button class="btn btn-outline-green" id="btnSendDigest">
                        <i class="fas fa-paper-plane"></i> Send Week to Telegram
                    </button>
                    <select id="scheduleRange" class="pf-view-select" style="max-width:200px;">
                        <option value="7">Next 7 Days</option>
                        <option value="14" selected>Next 14 Days</option>
                        <option value="28">Next 28 Days</option>
                        <option value="56">Next 8 Weeks</option>
                    </select>
                </div>

                <!-- Active Subscribers Card -->
                <div class="adm-card" style="margin-bottom:1.5rem;">
                    <h3><i class="fas fa-users" style="color:var(--primary);"></i> Active Subscribers &amp; Service Requirements</h3>
                    <p style="font-size:0.85rem;color:var(--text-light);margin-bottom:1rem;">All recurring subscription customers and what they need from you.</p>
                    <div style="overflow-x:auto;">
                        <table class="adm-payments-table" id="subsTable">
                            <thead>
                                <tr>
                                    <th>Client</th>
                                    <th>Package</th>
                                    <th>Preferred Day</th>
                                    <th>Frequency</th>
                                    <th>Services Included</th>
                                    <th>Location</th>
                                    <th>Distance</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="subsTableBody">
                                <tr><td colspan="9" class="adm-empty"><i class="fas fa-spinner fa-spin"></i> Loading subscribers...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Upcoming Schedule -->
                <div class="adm-card">
                    <h3><i class="fas fa-calendar-alt" style="color:var(--primary);"></i> Upcoming Scheduled Visits</h3>
                    <p style="font-size:0.85rem;color:var(--text-light);margin-bottom:1rem;">Auto-generated from your subscribers' packages. These feed into your Daily Dispatch.</p>
                    <div id="scheduleTimeline">
                        <p class="adm-empty"><i class="fas fa-spinner fa-spin"></i> Loading schedule...</p>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ PANEL: Payments ‚îÄ‚îÄ -->
            <div class="adm-tab-panel" id="panelPayments">
                <div class="adm-card">
                    <h3><i class="fas fa-credit-card"></i> All Payments &amp; Subscriptions</h3>
                    <div style="overflow-x:auto;">
                        <table class="adm-payments-table">
                            <thead>
                                <tr>
                                    <th>Job #</th>
                                    <th>Client</th>
                                    <th>Service</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Method</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="paymentsTableBody">
                                <tr><td colspan="8" class="adm-empty"><i class="fas fa-spinner fa-spin"></i> Loading payments...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ PANEL: Newsletter ‚îÄ‚îÄ -->
            <div class="adm-tab-panel" id="panelNewsletter">
                <div class="adm-row">
                    <!-- Compose Newsletter -->
                    <div class="adm-card" style="flex:2;">
                        <h3><i class="fas fa-pen-fancy"></i> Compose Newsletter</h3>
                        <form id="nlComposeForm">
                            <div style="margin-bottom:1rem;">
                                <label style="display:block;font-size:0.85rem;font-weight:600;margin-bottom:0.35rem;color:#555;">Subject Line</label>
                                <input type="text" id="nlSubject" placeholder="e.g. üåø Summer Garden Care Tips ‚Äî June Newsletter" style="width:100%;padding:0.7rem 1rem;border:1px solid #ddd;border-radius:8px;font-size:0.95rem;font-family:'Poppins',sans-serif;" required>
                            </div>
                            <div style="margin-bottom:1rem;">
                                <label style="display:block;font-size:0.85rem;font-weight:600;margin-bottom:0.35rem;color:#555;">Content <span style="font-weight:400;color:#999;">(HTML supported)</span></label>
                                <textarea id="nlContent" rows="10" placeholder="Write your newsletter content here... HTML tags like <h3>, <p>, <ul>, <li>, <strong>, <a> are supported." style="width:100%;padding:0.7rem 1rem;border:1px solid #ddd;border-radius:8px;font-size:0.9rem;font-family:'Poppins',sans-serif;resize:vertical;" required></textarea>
                            </div>
                            <div style="margin-bottom:1rem;">
                                <label style="display:block;font-size:0.85rem;font-weight:600;margin-bottom:0.35rem;color:#555;">‚≠ê Exclusive Content <span style="font-weight:400;color:#999;">(Paid subscribers only ‚Äî leave blank for none)</span></label>
                                <textarea id="nlExclusive" rows="5" placeholder="e.g. Special discount code, premium tips, seasonal maintenance schedule..." style="width:100%;padding:0.7rem 1rem;border:1px solid #ddd;border-radius:8px;font-size:0.9rem;font-family:'Poppins',sans-serif;resize:vertical;border-color:#FFD700;"></textarea>
                            </div>
                            <div style="display:flex;gap:0.75rem;align-items:center;flex-wrap:wrap;margin-bottom:1rem;">
                                <label style="font-size:0.85rem;font-weight:600;color:#555;">Send To:</label>
                                <select id="nlTarget" style="padding:0.5rem 1rem;border:1px solid #ddd;border-radius:8px;font-size:0.9rem;font-family:'Poppins',sans-serif;">
                                    <option value="all">All Subscribers</option>
                                    <option value="paid">Paid Plans Only</option>
                                    <option value="free">Free Subscribers Only</option>
                                    <option value="essential">Essential Plan</option>
                                    <option value="standard">Standard Plan</option>
                                    <option value="premium">Premium Plan</option>
                                </select>
                            </div>
                            <div style="margin-bottom:1rem;">
                                <label style="display:block;font-size:0.85rem;font-weight:600;margin-bottom:0.35rem;color:#555;">Header Image <span style="font-weight:400;color:#999;">(optional ‚Äî auto-fetch or paste URL)</span></label>
                                <div style="display:flex;gap:0.5rem;">
                                    <input type="url" id="nlHeaderImage" placeholder="https://images.pexels.com/..." style="flex:1;padding:0.5rem 1rem;border:1px solid #ddd;border-radius:8px;font-size:0.9rem;font-family:'Poppins',sans-serif;">
                                    <button type="button" id="nlFetchImageBtn" class="btn btn-outline-green" style="white-space:nowrap;"><i class="fas fa-search"></i> Fetch Image</button>
                                </div>
                                <div id="nlImagePreview" style="display:none;margin-top:0.5rem;border-radius:8px;overflow:hidden;max-height:200px;">
                                    <img id="nlImagePreviewImg" src="" alt="Preview" style="width:100%;height:auto;display:block;">
                                </div>
                            </div>
                            <div style="display:flex;gap:0.75rem;">
                                <button type="button" id="nlPreviewBtn" class="btn btn-outline-green" style="flex:1;"><i class="fas fa-eye"></i> Preview</button>
                                <button type="submit" id="nlSendBtn" class="btn btn-primary" style="flex:1;"><i class="fas fa-paper-plane"></i> Send Newsletter</button>
                            </div>
                        </form>
                        <div id="nlSendMsg" style="margin-top:1rem;font-size:0.9rem;font-weight:600;"></div>
                    </div>

                    <!-- Subscriber Stats + History -->
                    <div style="flex:1;min-width:280px;">
                        <div class="adm-card">
                            <h3><i class="fas fa-users"></i> Subscribers</h3>
                            <div id="nlSubStats">
                                <p class="adm-empty"><i class="fas fa-spinner fa-spin"></i> Loading...</p>
                            </div>
                        </div>
                        <div class="adm-card" style="margin-top:1rem;">
                            <h3><i class="fas fa-history"></i> Sent Newsletters</h3>
                            <div id="nlHistory">
                                <p class="adm-empty"><i class="fas fa-spinner fa-spin"></i> Loading...</p>
                            </div>
                        </div>
                        <div class="adm-card" style="margin-top:1rem;">
                            <h3><i class="fas fa-list"></i> Subscriber List</h3>
                            <div id="nlSubList" style="max-height:300px;overflow-y:auto;">
                                <p class="adm-empty"><i class="fas fa-spinner fa-spin"></i> Loading...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview Modal -->
                <div id="nlPreviewModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:9999;align-items:center;justify-content:center;">
                    <div style="background:#fff;border-radius:12px;max-width:650px;width:95%;max-height:85vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3);">
                        <div style="padding:15px 20px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;">
                            <strong><i class="fas fa-eye"></i> Email Preview</strong>
                            <button id="nlPreviewClose" style="background:none;border:none;font-size:1.3rem;cursor:pointer;color:#666;">&times;</button>
                        </div>
                        <div id="nlPreviewBody" style="padding:0;"></div>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ PANEL: Telegram ‚îÄ‚îÄ -->
            <div class="adm-tab-panel" id="panelTelegram">
                <div class="adm-row">
                    <div class="adm-card">
                        <h3><i class="fas fa-paper-plane"></i> Telegram Messages</h3>
                        <div class="adm-tg-log" id="tgLog"></div>
                        <form class="adm-tg-form" id="tgSendForm">
                            <input type="text" id="tgMessage" placeholder="Type a message..." autocomplete="off">
                            <button type="submit"><i class="fas fa-paper-plane"></i></button>
                        </form>
                        <div class="adm-tg-quick">
                            <button type="button" onclick="sendTgQuick('on-way')">üöó On My Way</button>
                            <button type="button" onclick="sendTgQuick('arrived')">üëã Arrived</button>
                            <button type="button" onclick="sendTgQuick('completed')">‚úÖ Completed</button>
                            <button type="button" onclick="sendTgQuick('reminder')">üìÖ Reminder</button>
                            <button type="button" onclick="sendTgQuick('payment')">üí≥ Payment</button>
                            <button type="button" onclick="sendTgQuick('weather')">üåßÔ∏è Weather</button>
                        </div>
                    </div>
                    <div>
                        <div class="adm-card">
                            <h3><i class="fas fa-cog"></i> Telegram Bot</h3>
                            <div style="font-size:0.85rem; color:#6b7f93; line-height:1.8;">
                                <div><strong>Status:</strong> <span style="color:#2E7D32;">‚óè Active</span></div>
                                <div><strong>Bot:</strong> Gardners GM Bot</div>
                                <div><strong>Chat ID:</strong> 6200151295</div>
                                <div style="margin-top:0.5rem; font-size:0.78rem; color:#a0aec0;">
                                    Notifications sent for: bookings, invoices, job completions, blog posts, live chat messages.
                                </div>
                            </div>
                        </div>
                        <div class="adm-card" style="margin-top:1rem;">
                            <h3><i class="fas fa-bell"></i> Auto-Notifications</h3>
                            <div style="font-size:0.82rem; line-height:2;">
                                <div><span class="adm-badge adm-badge-green">Active</span> New bookings</div>
                                <div><span class="adm-badge adm-badge-green">Active</span> Invoice sent</div>
                                <div><span class="adm-badge adm-badge-green">Active</span> Job completed</div>
                                <div><span class="adm-badge adm-badge-green">Active</span> Blog published</div>
                                <div><span class="adm-badge adm-badge-green">Active</span> Live chat messages</div>
                                <div><span class="adm-badge adm-badge-green">Active</span> New testimonials</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ PANEL: Email Workflow ‚îÄ‚îÄ -->
            <div class="adm-tab-panel" id="panelEmailWorkflow">

                <!-- Email Stats Cards -->
                <div class="adm-stats-grid" style="margin-bottom:1.5rem;">
                    <div class="adm-stat-card">
                        <div class="adm-stat-icon green"><i class="fas fa-envelope"></i></div>
                        <div>
                            <div class="adm-stat-value" id="ewToday">0</div>
                            <div class="adm-stat-label">Emails Today</div>
                        </div>
                    </div>
                    <div class="adm-stat-card">
                        <div class="adm-stat-icon blue"><i class="fas fa-calendar-week"></i></div>
                        <div>
                            <div class="adm-stat-value" id="ewWeek">0</div>
                            <div class="adm-stat-label">This Week</div>
                        </div>
                    </div>
                    <div class="adm-stat-card">
                        <div class="adm-stat-icon purple"><i class="fas fa-calendar-alt"></i></div>
                        <div>
                            <div class="adm-stat-value" id="ewMonth">0</div>
                            <div class="adm-stat-label">This Month</div>
                        </div>
                    </div>
                    <div class="adm-stat-card">
                        <div class="adm-stat-icon" style="background:rgba(230,81,0,0.12);color:#E65100;"><i class="fas fa-file-signature"></i></div>
                        <div>
                            <div class="adm-stat-value" id="ewTermsTotal">0</div>
                            <div class="adm-stat-label">Terms Accepted</div>
                        </div>
                    </div>
                </div>

                <!-- Terms Breakdown -->
                <div class="adm-card" style="margin-bottom:1.5rem;">
                    <h3><i class="fas fa-file-contract" style="color:#1565C0;"></i> Terms Acceptance Breakdown</h3>
                    <div class="adm-stats-grid" style="margin-top:0.75rem;">
                        <div style="text-align:center;padding:1rem;background:#E8F5E9;border-radius:8px;">
                            <div style="font-size:1.5rem;font-weight:700;color:#2E7D32;" id="ewPayNow">0</div>
                            <div style="font-size:0.8rem;color:#666;">Pay Now</div>
                        </div>
                        <div style="text-align:center;padding:1rem;background:#FFF3E0;border-radius:8px;">
                            <div style="font-size:1.5rem;font-weight:700;color:#E65100;" id="ewPayLater">0</div>
                            <div style="font-size:0.8rem;color:#666;">Pay Later</div>
                        </div>
                        <div style="text-align:center;padding:1rem;background:#E3F2FD;border-radius:8px;">
                            <div style="font-size:1.5rem;font-weight:700;color:#1565C0;" id="ewSubscription">0</div>
                            <div style="font-size:0.8rem;color:#666;">Subscription</div>
                        </div>
                    </div>
                </div>

                <!-- Live Income vs Expenditure -->
                <div class="adm-card" style="margin-bottom:1.5rem;border-left:4px solid #2E7D32;">
                    <h3><i class="fas fa-balance-scale" style="color:#2E7D32;"></i> Live Income vs Expenditure</h3>
                    <div id="ewIncomeLoading" style="text-align:center;padding:1rem;color:#999;"><i class="fas fa-spinner fa-spin"></i> Loading financials...</div>
                    <div id="ewIncomeContent" style="display:none;">
                        <div class="adm-stats-grid" style="margin-bottom:1rem;">
                            <div class="adm-stat-card" style="border-left:4px solid #2E7D32;">
                                <div>
                                    <div class="adm-stat-value" style="color:#2E7D32;" id="ewIncome">¬£0</div>
                                    <div class="adm-stat-label">Total Income</div>
                                </div>
                            </div>
                            <div class="adm-stat-card" style="border-left:4px solid #E53935;">
                                <div>
                                    <div class="adm-stat-value" style="color:#E53935;" id="ewExpenditure">¬£0</div>
                                    <div class="adm-stat-label">Total Expenditure</div>
                                </div>
                            </div>
                            <div class="adm-stat-card" style="border-left:4px solid #1565C0;">
                                <div>
                                    <div class="adm-stat-value" id="ewNetProfit">¬£0</div>
                                    <div class="adm-stat-label">Net Profit</div>
                                </div>
                            </div>
                        </div>
                        <!-- Income/Expense progress bar -->
                        <div style="margin-bottom:0.75rem;">
                            <div style="display:flex;justify-content:space-between;font-size:0.78rem;color:#6b7f93;margin-bottom:0.3rem;">
                                <span>Income</span><span>Expenses</span>
                            </div>
                            <div style="height:24px;background:#f3f4f6;border-radius:12px;overflow:hidden;display:flex;">
                                <div id="ewBarIncome" style="background:linear-gradient(90deg,#2E7D32,#4CAF50);height:100%;transition:width 0.8s ease;" title="Income"></div>
                                <div id="ewBarExpense" style="background:linear-gradient(90deg,#E53935,#EF5350);height:100%;transition:width 0.8s ease;" title="Expenses"></div>
                            </div>
                        </div>
                        <div style="display:flex;flex-wrap:wrap;gap:0.75rem;font-size:0.82rem;color:#6b7f93;">
                            <span>üí∞ Pay-Now: <strong id="ewIncPayNow">¬£0</strong></span>
                            <span>üìã Pay-Later (collected): <strong id="ewIncPayLater">¬£0</strong></span>
                            <span>üîÑ Subscriptions: <strong id="ewIncSubs">¬£0</strong></span>
                            <span>‚è≥ Outstanding: <strong id="ewIncOutstanding" style="color:#E65100;">¬£0</strong></span>
                        </div>
                    </div>
                </div>

                <!-- Recent Emails Table -->
                <div class="adm-card">
                    <h3><i class="fas fa-inbox" style="color:var(--primary);"></i> Recent Automated Emails</h3>
                    <p style="font-size:0.85rem;color:var(--text-light);margin-bottom:1rem;">Live log of all automated emails sent to customers.</p>
                    <div style="overflow-x:auto;">
                        <table class="adm-payments-table" id="ewEmailTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Recipient</th>
                                    <th>Type</th>
                                    <th>Service</th>
                                    <th>Job #</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="ewEmailTableBody">
                                <tr><td colspan="6" class="adm-empty"><i class="fas fa-spinner fa-spin"></i> Loading email history...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ PANEL: Quote Builder ‚îÄ‚îÄ -->
            <div class="adm-tab-panel" id="panelQuoteBuilder">
                <h2 style="margin:0 0 20px;"><i class="fas fa-calculator"></i> Quote Builder</h2>

                <!-- Stats Row -->
                <div class="adm-row" style="margin-bottom:24px;">
                    <div class="adm-stat-card"><div class="adm-stat-value" id="qbStatTotal">0</div><div class="adm-stat-label">Total Quotes</div></div>
                    <div class="adm-stat-card"><div class="adm-stat-value" id="qbStatSent">0</div><div class="adm-stat-label">Sent</div></div>
                    <div class="adm-stat-card"><div class="adm-stat-value" id="qbStatAccepted">0</div><div class="adm-stat-label">Accepted</div></div>
                    <div class="adm-stat-card"><div class="adm-stat-value" id="qbStatDeclined">0</div><div class="adm-stat-label">Declined</div></div>
                    <div class="adm-stat-card"><div class="adm-stat-value" id="qbStatValue">¬£0</div><div class="adm-stat-label">Total Value</div></div>
                </div>

                <!-- New Quote button -->
                <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;align-items:center;">
                    <button id="qbNewQuoteBtn" class="adm-btn" style="background:#1B5E20;color:#fff;padding:10px 24px;border:none;border-radius:8px;font-size:15px;cursor:pointer;"><i class="fas fa-plus"></i> New Quote</button>
                    <select id="qbFilterStatus" style="padding:8px 14px;border:1px solid #ddd;border-radius:6px;font-size:14px;">
                        <option value="">All Statuses</option>
                        <option value="Draft">Draft</option>
                        <option value="Sent">Sent</option>
                        <option value="Accepted">Accepted</option>
                        <option value="Declined">Declined</option>
                        <option value="Expired">Expired</option>
                        <option value="Deposit Paid">Deposit Paid</option>
                    </select>
                    <input type="text" id="qbSearch" placeholder="Search quotes..." style="padding:8px 14px;border:1px solid #ddd;border-radius:6px;font-size:14px;flex:1;min-width:200px;">
                </div>

                <!-- Quotes Table -->
                <div class="adm-card" style="overflow-x:auto;">
                    <table class="adm-table" style="width:100%;border-collapse:collapse;">
                        <thead>
                            <tr style="background:#f5f5f5;">
                                <th style="padding:10px;">Quote #</th>
                                <th style="padding:10px;">Customer</th>
                                <th style="padding:10px;">Title</th>
                                <th style="padding:10px;">Total</th>
                                <th style="padding:10px;">Status</th>
                                <th style="padding:10px;">Date</th>
                                <th style="padding:10px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="qbQuotesTableBody">
                            <tr><td colspan="7" style="text-align:center;padding:30px;color:#999;"><i class="fas fa-calculator"></i> Click "New Quote" to create your first quote</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Quote Builder Modal -->
                <div id="qbModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:9999;overflow-y:auto;padding:20px;">
                    <div style="max-width:1050px;margin:20px auto;background:#fff;border-radius:12px;overflow:hidden;">
                        <div style="background:linear-gradient(135deg,#1B5E20,#2E7D32);padding:20px 24px;display:flex;justify-content:space-between;align-items:center;">
                            <h3 style="color:#fff;margin:0;"><i class="fas fa-calculator"></i> <span id="qbModalTitle">New Quote</span></h3>
                            <button id="qbModalClose" style="background:none;border:none;color:#fff;font-size:24px;cursor:pointer;">&times;</button>
                        </div>
                        <div style="padding:24px;">
                            <!-- Customer Section -->
                            <div style="background:#f8f9fa;border-radius:8px;padding:20px;margin-bottom:20px;">
                                <h4 style="margin:0 0 15px;color:#1B5E20;"><i class="fas fa-user"></i> Customer Details</h4>
                                <div style="display:flex;gap:12px;margin-bottom:10px;flex-wrap:wrap;">
                                    <select id="qbExistingCustomer" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;">
                                        <option value="">-- Link existing customer or type new --</option>
                                    </select>
                                </div>
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                                    <input type="text" id="qbCustName" placeholder="Full Name *" style="padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;">
                                    <input type="email" id="qbCustEmail" placeholder="Email Address *" style="padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;">
                                    <input type="tel" id="qbCustPhone" placeholder="Phone Number" style="padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;">
                                    <input type="text" id="qbCustPostcode" placeholder="Postcode" style="padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;">
                                    <input type="text" id="qbCustAddress" placeholder="Full Address" style="padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;grid-column:span 2;">
                                </div>
                            </div>

                            <!-- Quote Details -->
                            <div style="background:#f8f9fa;border-radius:8px;padding:20px;margin-bottom:20px;">
                                <h4 style="margin:0 0 15px;color:#1B5E20;"><i class="fas fa-file-invoice"></i> Quote Details</h4>
                                <input type="text" id="qbTitle" placeholder="Quote Title (e.g. Full Garden Renovation, Multi-Service Visit, Emergency + Hedge Trim)" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;margin-bottom:12px;box-sizing:border-box;">
                                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
                                    <div>
                                        <label style="font-size:12px;font-weight:600;color:#666;">Estimated Duration</label>
                                        <div style="display:flex;gap:6px;">
                                            <input type="number" id="qbEstDays" min="0" value="0" placeholder="Days" style="width:50%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:13px;">
                                            <input type="number" id="qbEstHours" min="0" value="0" placeholder="Hrs" style="width:50%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:13px;">
                                        </div>
                                    </div>
                                    <div>
                                        <label style="font-size:12px;font-weight:600;color:#666;">Job Complexity</label>
                                        <select id="qbComplexity" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:13px;">
                                            <option value="standard">Standard</option>
                                            <option value="complex">Complex</option>
                                            <option value="specialist">Specialist / Dangerous</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="font-size:12px;font-weight:600;color:#666;">Valid For</label>
                                        <select id="qbValidDays" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:13px;">
                                            <option value="14">14 days</option>
                                            <option value="30" selected>30 days</option>
                                            <option value="60">60 days</option>
                                            <option value="90">90 days</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Line Items ‚Äî Categorised -->
                            <div style="background:#f8f9fa;border-radius:8px;padding:20px;margin-bottom:20px;">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:10px;">
                                    <h4 style="margin:0;color:#1B5E20;"><i class="fas fa-list"></i> Line Items</h4>
                                </div>

                                <!-- Quick-Add Buttons grouped by category -->
                                <div style="margin-bottom:16px;">
                                    <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px;">
                                        <button type="button" class="qb-cat-toggle" data-cat="services" style="background:#1B5E20;color:#fff;border:none;padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;font-weight:600;"><i class="fas fa-leaf"></i> Services</button>
                                        <button type="button" class="qb-cat-toggle" data-cat="labour" style="background:#1565C0;color:#fff;border:none;padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;font-weight:600;"><i class="fas fa-hard-hat"></i> Labour</button>
                                        <button type="button" class="qb-cat-toggle" data-cat="materials" style="background:#6A1B9A;color:#fff;border:none;padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;font-weight:600;"><i class="fas fa-box-open"></i> Materials</button>
                                        <button type="button" class="qb-cat-toggle" data-cat="equipment" style="background:#E65100;color:#fff;border:none;padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;font-weight:600;"><i class="fas fa-truck"></i> Equipment Hire</button>
                                        <button type="button" class="qb-cat-toggle" data-cat="traffic" style="background:#C62828;color:#fff;border:none;padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;font-weight:600;"><i class="fas fa-road"></i> Traffic Management</button>
                                        <button type="button" class="qb-cat-toggle" data-cat="waste" style="background:#795548;color:#fff;border:none;padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;font-weight:600;"><i class="fas fa-dumpster"></i> Waste & Disposal</button>
                                        <button type="button" class="qb-cat-toggle" data-cat="custom" style="background:#455A64;color:#fff;border:none;padding:6px 14px;border-radius:20px;font-size:12px;cursor:pointer;font-weight:600;"><i class="fas fa-plus"></i> Custom Item</button>
                                    </div>

                                    <!-- Category quick-add panels (hidden by default, shown on toggle) -->
                                    <div id="qbCatPanel_services" class="qb-cat-panel" style="display:none;background:#E8F5E9;border-radius:8px;padding:12px;margin-bottom:8px;">
                                        <div style="display:flex;flex-wrap:wrap;gap:6px;">
                                            <button type="button" class="qb-template-btn" data-desc="Lawn Cutting" data-price="40" data-unit="job" data-cat="service">Lawn Cutting ¬£40</button>
                                            <button type="button" class="qb-template-btn" data-desc="Hedge Trimming" data-price="60" data-unit="job" data-cat="service">Hedge Trimming ¬£60</button>
                                            <button type="button" class="qb-template-btn" data-desc="Scarifying" data-price="80" data-unit="job" data-cat="service">Scarifying ¬£80</button>
                                            <button type="button" class="qb-template-btn" data-desc="Lawn Treatment" data-price="45" data-unit="job" data-cat="service">Lawn Treatment ¬£45</button>
                                            <button type="button" class="qb-template-btn" data-desc="Garden Clearance" data-price="120" data-unit="job" data-cat="service">Garden Clearance ¬£120</button>
                                            <button type="button" class="qb-template-btn" data-desc="Power Washing" data-price="60" data-unit="job" data-cat="service">Power Washing ¬£60</button>
                                            <button type="button" class="qb-template-btn" data-desc="Veg Patch Setup" data-price="80" data-unit="job" data-cat="service">Veg Patch ¬£80</button>
                                            <button type="button" class="qb-template-btn" data-desc="Weeding Treatment" data-price="50" data-unit="job" data-cat="service">Weeding ¬£50</button>
                                            <button type="button" class="qb-template-btn" data-desc="Fence Repair" data-price="75" data-unit="job" data-cat="service">Fence Repair ¬£75</button>
                                            <button type="button" class="qb-template-btn" data-desc="Emergency Tree Surgery" data-price="150" data-unit="job" data-cat="service">Emergency Tree ¬£150</button>
                                            <button type="button" class="qb-template-btn" data-desc="Drain Clearance" data-price="45" data-unit="job" data-cat="service">Drain Clearance ¬£45</button>
                                            <button type="button" class="qb-template-btn" data-desc="Gutter Cleaning" data-price="55" data-unit="job" data-cat="service">Gutter Cleaning ¬£55</button>
                                            <button type="button" class="qb-template-btn" data-desc="Tree Felling" data-price="200" data-unit="job" data-cat="service">Tree Felling ¬£200+</button>
                                            <button type="button" class="qb-template-btn" data-desc="Stump Grinding" data-price="80" data-unit="job" data-cat="service">Stump Grinding ¬£80</button>
                                            <button type="button" class="qb-template-btn" data-desc="Turfing / Re-turfing" data-price="12" data-unit="m¬≤" data-cat="service">Turfing ¬£12/m¬≤</button>
                                            <button type="button" class="qb-template-btn" data-desc="Landscaping" data-price="0" data-unit="job" data-cat="service">Landscaping (price TBC)</button>
                                            <button type="button" class="qb-template-btn" data-desc="Decking Installation" data-price="0" data-unit="m¬≤" data-cat="service">Decking (price TBC)</button>
                                            <button type="button" class="qb-template-btn" data-desc="Patio Laying" data-price="0" data-unit="m¬≤" data-cat="service">Patio Laying (TBC)</button>
                                            <button type="button" class="qb-template-btn" data-desc="Fencing (new panels)" data-price="65" data-unit="panel" data-cat="service">Fencing ¬£65/panel</button>
                                            <button type="button" class="qb-template-btn" data-desc="Pond / Water Feature" data-price="0" data-unit="job" data-cat="service">Pond / Water Feature</button>
                                        </div>
                                    </div>

                                    <div id="qbCatPanel_labour" class="qb-cat-panel" style="display:none;background:#E3F2FD;border-radius:8px;padding:12px;margin-bottom:8px;">
                                        <div style="display:flex;flex-wrap:wrap;gap:6px;">
                                            <button type="button" class="qb-template-btn" data-desc="Gardener (standard rate)" data-price="25" data-unit="hour" data-cat="labour">Gardener ¬£25/hr</button>
                                            <button type="button" class="qb-template-btn" data-desc="Gardener (full day)" data-price="180" data-unit="day" data-cat="labour">Gardener ¬£180/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Additional Labourer" data-price="20" data-unit="hour" data-cat="labour">Labourer ¬£20/hr</button>
                                            <button type="button" class="qb-template-btn" data-desc="Additional Labourer (full day)" data-price="140" data-unit="day" data-cat="labour">Labourer ¬£140/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Tree Surgeon / Specialist" data-price="40" data-unit="hour" data-cat="labour">Specialist ¬£40/hr</button>
                                            <button type="button" class="qb-template-btn" data-desc="Tree Surgeon (full day)" data-price="280" data-unit="day" data-cat="labour">Specialist ¬£280/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Overtime / Unsociable Hours" data-price="35" data-unit="hour" data-cat="labour">Overtime ¬£35/hr</button>
                                            <button type="button" class="qb-template-btn" data-desc="Site Supervisor" data-price="30" data-unit="hour" data-cat="labour">Supervisor ¬£30/hr</button>
                                        </div>
                                    </div>

                                    <div id="qbCatPanel_materials" class="qb-cat-panel" style="display:none;background:#F3E5F5;border-radius:8px;padding:12px;margin-bottom:8px;">
                                        <div style="display:flex;flex-wrap:wrap;gap:6px;">
                                            <button type="button" class="qb-template-btn" data-desc="Topsoil (per bag)" data-price="6" data-unit="bag" data-cat="materials">Topsoil ¬£6/bag</button>
                                            <button type="button" class="qb-template-btn" data-desc="Compost / Mulch (per bag)" data-price="5" data-unit="bag" data-cat="materials">Compost ¬£5/bag</button>
                                            <button type="button" class="qb-template-btn" data-desc="Turf Rolls" data-price="4" data-unit="roll" data-cat="materials">Turf Rolls ¬£4/ea</button>
                                            <button type="button" class="qb-template-btn" data-desc="Grass Seed (per kg)" data-price="8" data-unit="kg" data-cat="materials">Grass Seed ¬£8/kg</button>
                                            <button type="button" class="qb-template-btn" data-desc="Fence Panels (6x6)" data-price="35" data-unit="panel" data-cat="materials">Fence Panel ¬£35</button>
                                            <button type="button" class="qb-template-btn" data-desc="Fence Posts" data-price="12" data-unit="each" data-cat="materials">Fence Post ¬£12</button>
                                            <button type="button" class="qb-template-btn" data-desc="Postcrete / Concrete" data-price="7" data-unit="bag" data-cat="materials">Postcrete ¬£7/bag</button>
                                            <button type="button" class="qb-template-btn" data-desc="Gravel / Aggregate (bulk bag)" data-price="65" data-unit="bag" data-cat="materials">Gravel ¬£65/bulk bag</button>
                                            <button type="button" class="qb-template-btn" data-desc="Membrane / Weed Fabric" data-price="2" data-unit="m¬≤" data-cat="materials">Weed Fabric ¬£2/m¬≤</button>
                                            <button type="button" class="qb-template-btn" data-desc="Sleepers (2.4m)" data-price="22" data-unit="each" data-cat="materials">Sleeper ¬£22/ea</button>
                                            <button type="button" class="qb-template-btn" data-desc="Paving Slabs" data-price="5" data-unit="each" data-cat="materials">Paving Slab ¬£5/ea</button>
                                            <button type="button" class="qb-template-btn" data-desc="Trellis Panel" data-price="18" data-unit="each" data-cat="materials">Trellis ¬£18/ea</button>
                                            <button type="button" class="qb-template-btn" data-desc="Lawn Feed / Treatment" data-price="15" data-unit="bag" data-cat="materials">Lawn Feed ¬£15</button>
                                            <button type="button" class="qb-template-btn" data-desc="Weedkiller (per litre)" data-price="12" data-unit="litre" data-cat="materials">Weedkiller ¬£12/L</button>
                                            <button type="button" class="qb-template-btn" data-desc="Plants / Shrubs" data-price="0" data-unit="each" data-cat="materials">Plants (price TBC)</button>
                                        </div>
                                    </div>

                                    <div id="qbCatPanel_equipment" class="qb-cat-panel" style="display:none;background:#FFF3E0;border-radius:8px;padding:12px;margin-bottom:8px;">
                                        <div style="display:flex;flex-wrap:wrap;gap:6px;">
                                            <button type="button" class="qb-template-btn" data-desc="Chipper / Shredder Hire" data-price="85" data-unit="day" data-cat="equipment">Chipper ¬£85/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Stump Grinder Hire" data-price="120" data-unit="day" data-cat="equipment">Stump Grinder ¬£120/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Mini Digger / Excavator" data-price="180" data-unit="day" data-cat="equipment">Mini Digger ¬£180/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Rotavator Hire" data-price="55" data-unit="day" data-cat="equipment">Rotavator ¬£55/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Pressure Washer (industrial)" data-price="45" data-unit="day" data-cat="equipment">Pressure Washer ¬£45/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Scaffold Tower" data-price="65" data-unit="day" data-cat="equipment">Scaffold Tower ¬£65/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Cherry Picker / MEWP" data-price="250" data-unit="day" data-cat="equipment">Cherry Picker ¬£250/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Skip (6 yard)" data-price="220" data-unit="each" data-cat="equipment">6yd Skip ¬£220</button>
                                            <button type="button" class="qb-template-btn" data-desc="Skip (8 yard)" data-price="280" data-unit="each" data-cat="equipment">8yd Skip ¬£280</button>
                                            <button type="button" class="qb-template-btn" data-desc="Generator Hire" data-price="40" data-unit="day" data-cat="equipment">Generator ¬£40/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Chainsaw (specialist hire)" data-price="45" data-unit="day" data-cat="equipment">Chainsaw ¬£45/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Plate Compactor" data-price="35" data-unit="day" data-cat="equipment">Compactor ¬£35/day</button>
                                        </div>
                                    </div>

                                    <div id="qbCatPanel_traffic" class="qb-cat-panel" style="display:none;background:#FFEBEE;border-radius:8px;padding:12px;margin-bottom:8px;">
                                        <p style="margin:0 0 8px;font-size:12px;color:#c62828;"><i class="fas fa-info-circle"></i> Guide prices ‚Äî adjust per job. Permit fees set by Cornwall Council and may vary.</p>
                                        <div style="display:flex;flex-wrap:wrap;gap:6px;">
                                            <!-- Plans & Permits -->
                                            <button type="button" class="qb-template-btn" data-desc="Traffic Management Plan (Chapter 8 Design)" data-price="350" data-unit="job" data-cat="traffic">TM Plan ¬£350</button>
                                            <button type="button" class="qb-template-btn" data-desc="Complex TM Plan (Multi-phase / Junction)" data-price="650" data-unit="job" data-cat="traffic">Complex TM Plan ¬£650</button>
                                            <button type="button" class="qb-template-btn" data-desc="TTRO Application (Temp Road Closure Order)" data-price="2500" data-unit="job" data-cat="traffic">TTRO Application ¬£2,500</button>
                                            <button type="button" class="qb-template-btn" data-desc="Street Works License (Section 50)" data-price="500" data-unit="job" data-cat="traffic">Street Works Licence ¬£500</button>
                                            <button type="button" class="qb-template-btn" data-desc="S171 Highway Licence (Scaffolding / Skip)" data-price="115" data-unit="job" data-cat="traffic">S171 Licence ¬£115</button>
                                            <!-- Temporary Traffic Lights -->
                                            <button type="button" class="qb-template-btn" data-desc="2-Way Portable Traffic Lights" data-price="185" data-unit="day" data-cat="traffic">2-Way Lights ¬£185/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="3-Way Portable Traffic Lights" data-price="275" data-unit="day" data-cat="traffic">3-Way Lights ¬£275/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="4-Way Portable Traffic Lights" data-price="380" data-unit="day" data-cat="traffic">4-Way Lights ¬£380/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Manual Stop/Go Boards (per operative)" data-price="220" data-unit="day" data-cat="traffic">Stop/Go Boards ¬£220/day</button>
                                            <!-- Personnel -->
                                            <button type="button" class="qb-template-btn" data-desc="Banksman / Traffic Marshal (CSCS)" data-price="28" data-unit="hour" data-cat="traffic">Traffic Marshal ¬£28/hr</button>
                                            <button type="button" class="qb-template-btn" data-desc="Traffic Marshal Full Day (10hr)" data-price="250" data-unit="day" data-cat="traffic">Marshal Day Rate ¬£250</button>
                                            <!-- Barriers & Fencing -->
                                            <button type="button" class="qb-template-btn" data-desc="Heras Fencing Panel (per week)" data-price="8" data-unit="each" data-cat="traffic">Heras Fence ¬£8/panel/wk</button>
                                            <button type="button" class="qb-template-btn" data-desc="Chapter 8 Barrier (per metre)" data-price="6" data-unit="linear m" data-cat="traffic">Ch.8 Barrier ¬£6/m</button>
                                            <button type="button" class="qb-template-btn" data-desc="Pedestrian Walkway / Covered Way" data-price="140" data-unit="day" data-cat="traffic">Ped Walkway ¬£140/day</button>
                                            <!-- Signage & Equipment -->
                                            <button type="button" class="qb-template-btn" data-desc="Signage & Cone Setup (standard layout)" data-price="95" data-unit="day" data-cat="traffic">Signs & Cones ¬£95/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="Chapter 8 Vehicle Signage Kit" data-price="45" data-unit="day" data-cat="traffic">Vehicle Signage ¬£45/day</button>
                                            <button type="button" class="qb-template-btn" data-desc="TM Delivery & Collection" data-price="120" data-unit="trip" data-cat="traffic">TM Delivery ¬£120</button>
                                        </div>
                                    </div>

                                    <div id="qbCatPanel_waste" class="qb-cat-panel" style="display:none;background:#EFEBE9;border-radius:8px;padding:12px;margin-bottom:8px;">
                                        <div style="display:flex;flex-wrap:wrap;gap:6px;">
                                            <button type="button" class="qb-template-btn" data-desc="Green Waste Removal" data-price="40" data-unit="load" data-cat="waste">Green Waste ¬£40/load</button>
                                            <button type="button" class="qb-template-btn" data-desc="General Waste Removal" data-price="60" data-unit="load" data-cat="waste">General Waste ¬£60/load</button>
                                            <button type="button" class="qb-template-btn" data-desc="Rubble / Hardcore Removal" data-price="80" data-unit="load" data-cat="waste">Rubble ¬£80/load</button>
                                            <button type="button" class="qb-template-btn" data-desc="Tip Run / Disposal Fee" data-price="25" data-unit="trip" data-cat="waste">Tip Run ¬£25/trip</button>
                                            <button type="button" class="qb-template-btn" data-desc="Soil Disposal" data-price="50" data-unit="load" data-cat="waste">Soil Disposal ¬£50/load</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Line Items Table (enhanced) -->
                                <table style="width:100%;border-collapse:collapse;" id="qbLineItemsTable">
                                    <thead>
                                        <tr style="background:#e8f5e9;">
                                            <th style="padding:8px 6px;text-align:center;width:5%;">Cat</th>
                                            <th style="padding:8px 6px;text-align:left;width:33%;">Description</th>
                                            <th style="padding:8px 6px;text-align:center;width:10%;">Qty</th>
                                            <th style="padding:8px 6px;text-align:center;width:12%;">Unit</th>
                                            <th style="padding:8px 6px;text-align:right;width:14%;">Unit Price</th>
                                            <th style="padding:8px 6px;text-align:right;width:14%;">Total</th>
                                            <th style="padding:8px 6px;text-align:center;width:12%;"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="qbLineItemsBody">
                                        <tr id="qbNoItems"><td colspan="7" style="text-align:center;padding:20px;color:#999;">No items yet ‚Äî click a category above to add items</td></tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Surcharges & Adjustments -->
                            <div style="background:#f8f9fa;border-radius:8px;padding:20px;margin-bottom:20px;">
                                <h4 style="margin:0 0 15px;color:#1B5E20;"><i class="fas fa-sliders-h"></i> Surcharges &amp; Adjustments</h4>
                                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;">
                                    <div>
                                        <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px;"><input type="checkbox" id="qbCalloutCharge"> Call-out charge</label>
                                        <input type="number" id="qbCalloutAmount" value="40" min="0" step="5" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;font-size:13px;margin-top:4px;" disabled>
                                    </div>
                                    <div>
                                        <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px;"><input type="checkbox" id="qbDistanceSurcharge"> Distance surcharge</label>
                                        <input type="number" id="qbDistanceAmount" value="0" min="0" step="5" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;font-size:13px;margin-top:4px;" disabled>
                                    </div>
                                    <div>
                                        <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px;"><input type="checkbox" id="qbUrgentSurcharge"> Urgent / Out-of-hours</label>
                                        <select id="qbUrgentPct" style="width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;font-size:13px;margin-top:4px;" disabled>
                                            <option value="25">+25%</option>
                                            <option value="50" selected>+50%</option>
                                            <option value="75">+75%</option>
                                            <option value="100">+100%</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Totals -->
                            <div style="background:#E8F5E9;border-radius:8px;padding:20px;margin-bottom:20px;">
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;max-width:500px;margin-left:auto;">
                                    <label style="text-align:right;padding:6px 0;font-weight:bold;">Subtotal:</label>
                                    <span id="qbSubtotal" style="text-align:right;padding:6px 0;font-weight:bold;">¬£0.00</span>
                                    <label style="text-align:right;padding:6px 0;font-size:13px;color:#666;">Call-out / Distance / Urgent:</label>
                                    <span id="qbSurchargesAmt" style="text-align:right;padding:6px 0;font-size:13px;">¬£0.00</span>
                                    <label style="text-align:right;padding:6px 0;">Discount (%):</label>
                                    <input type="number" id="qbDiscountPct" value="0" min="0" max="100" step="1" style="text-align:right;padding:6px;border:1px solid #ddd;border-radius:6px;font-size:13px;">
                                    <label style="text-align:right;padding:6px 0;">Discount Amount:</label>
                                    <span id="qbDiscountAmt" style="text-align:right;padding:6px 0;">-¬£0.00</span>
                                    <label style="text-align:right;padding:6px 0;">Add VAT (20%):</label>
                                    <div style="text-align:right;padding:6px 0;"><input type="checkbox" id="qbAddVat"> <span id="qbVatAmt">¬£0.00</span></div>
                                    <label style="text-align:right;padding:10px 0;font-size:20px;font-weight:bold;color:#1B5E20;border-top:2px solid #1B5E20;">GRAND TOTAL:</label>
                                    <span id="qbGrandTotal" style="text-align:right;padding:10px 0;font-size:20px;font-weight:bold;color:#1B5E20;border-top:2px solid #1B5E20;">¬£0.00</span>
                                    <label style="text-align:right;padding:6px 0;color:#E65100;">10% Deposit:</label>
                                    <span id="qbDepositAmt" style="text-align:right;padding:6px 0;color:#E65100;font-weight:bold;">¬£0.00</span>
                                </div>
                            </div>

                            <!-- Notes & Options -->
                            <div style="background:#f8f9fa;border-radius:8px;padding:20px;margin-bottom:20px;">
                                <h4 style="margin:0 0 15px;color:#1B5E20;"><i class="fas fa-sticky-note"></i> Notes &amp; Scope of Work</h4>
                                <textarea id="qbNotes" rows="4" placeholder="Detailed scope of work, access requirements, timescale, exclusions, site-specific notes..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;box-sizing:border-box;resize:vertical;"></textarea>
                                <div style="margin-top:12px;display:flex;gap:15px;flex-wrap:wrap;">
                                    <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px;"><input type="checkbox" id="qbRequireDeposit" checked> Require 10% deposit</label>
                                    <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px;"><input type="checkbox" id="qbIncludeBreakdown" checked> Include item breakdown in email</label>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div style="display:flex;gap:12px;justify-content:flex-end;flex-wrap:wrap;">
                                <button id="qbDuplicateQuote" style="background:#78909C;color:#fff;border:none;border-radius:8px;padding:12px 20px;font-size:14px;cursor:pointer;display:none;"><i class="fas fa-copy"></i> Duplicate</button>
                                <button id="qbSaveDraft" style="background:#78909C;color:#fff;border:none;border-radius:8px;padding:12px 24px;font-size:15px;cursor:pointer;"><i class="fas fa-save"></i> Save Draft</button>
                                <button id="qbSendQuote" style="background:#1B5E20;color:#fff;border:none;border-radius:8px;padding:12px 28px;font-size:15px;cursor:pointer;font-weight:bold;"><i class="fas fa-paper-plane"></i> Send Quote to Customer</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ PANEL: Shop Management ‚îÄ‚îÄ -->
            <div class="adm-tab-panel" id="panelShop">
                <div class="adm-card">
                    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;margin-bottom:1.2rem;">
                        <h3 style="margin:0;"><i class="fas fa-shopping-bag" style="color:#2E7D32;"></i> Products</h3>
                        <button id="btnAddProduct" style="background:#2E7D32;color:#fff;border:none;border-radius:8px;padding:10px 20px;cursor:pointer;font-weight:600;font-size:14px;"><i class="fas fa-plus"></i> Add Product</button>
                    </div>

                    <!-- Product Form (hidden) -->
                    <div id="productForm" style="display:none;background:#f8faf8;border:1px solid #ddd;border-radius:12px;padding:20px;margin-bottom:20px;">
                        <h4 id="productFormTitle" style="margin:0 0 15px;"><i class="fas fa-box"></i> New Product</h4>
                        <input type="hidden" id="productId">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                            <div><label style="font-size:13px;font-weight:600;display:block;margin-bottom:4px;">Product Name *</label><input type="text" id="productName" placeholder="e.g. Spring Lawn Feed 10kg" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;"></div>
                            <div><label style="font-size:13px;font-weight:600;display:block;margin-bottom:4px;">Category *</label><select id="productCategory" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;">
                                <option value="lawn-care">Lawn Care</option>
                                <option value="weed-control">Weed Control</option>
                                <option value="moss-treatment">Moss Treatment</option>
                                <option value="fertiliser">Fertiliser</option>
                                <option value="tools">Tools & Accessories</option>
                                <option value="seasonal">Seasonal</option>
                            </select></div>
                            <div><label style="font-size:13px;font-weight:600;display:block;margin-bottom:4px;">Price (¬£) *</label><input type="number" id="productPrice" step="0.01" min="0" placeholder="12.99" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;"></div>
                            <div><label style="font-size:13px;font-weight:600;display:block;margin-bottom:4px;">Stock Quantity *</label><input type="number" id="productStock" min="0" placeholder="20" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;"></div>
                            <div style="grid-column:span 2;"><label style="font-size:13px;font-weight:600;display:block;margin-bottom:4px;">Description</label><textarea id="productDesc" rows="2" placeholder="Brief product description..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;resize:vertical;"></textarea></div>
                            <div><label style="font-size:13px;font-weight:600;display:block;margin-bottom:4px;">Image URL</label><input type="url" id="productImage" placeholder="https://..." style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;"></div>
                            <div><label style="font-size:13px;font-weight:600;display:block;margin-bottom:4px;">Status</label><select id="productStatus" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;"><option value="active">Active (Visible)</option><option value="draft">Draft (Hidden)</option><option value="sold-out">Sold Out</option></select></div>
                        </div>
                        <div style="display:flex;gap:10px;margin-top:15px;justify-content:flex-end;">
                            <button onclick="hideProductForm()" style="background:#999;color:#fff;border:none;border-radius:8px;padding:10px 20px;cursor:pointer;">Cancel</button>
                            <button id="btnSaveProduct" onclick="saveProduct()" style="background:#2E7D32;color:#fff;border:none;border-radius:8px;padding:10px 24px;cursor:pointer;font-weight:600;"><i class="fas fa-save"></i> Save Product</button>
                        </div>
                    </div>

                    <!-- Products Table -->
                    <div style="overflow-x:auto;">
                        <table id="productsTable" style="width:100%;border-collapse:collapse;font-size:14px;">
                            <thead><tr style="background:#f0f4f0;">
                                <th style="padding:10px;text-align:left;">Product</th>
                                <th style="padding:10px;text-align:left;">Category</th>
                                <th style="padding:10px;text-align:right;">Price</th>
                                <th style="padding:10px;text-align:center;">Stock</th>
                                <th style="padding:10px;text-align:center;">Status</th>
                                <th style="padding:10px;text-align:center;">Actions</th>
                            </tr></thead>
                            <tbody id="productsBody"><tr><td colspan="6" style="padding:30px;text-align:center;color:#999;"><i class="fas fa-spinner fa-spin"></i> Loading products...</td></tr></tbody>
                        </table>
                    </div>
                </div>

                <!-- Orders -->
                <div class="adm-card" style="margin-top:1.5rem;">
                    <h3 style="margin:0 0 1rem;"><i class="fas fa-receipt" style="color:#2E7D32;"></i> Orders</h3>
                    <div style="overflow-x:auto;">
                        <table id="ordersTable" style="width:100%;border-collapse:collapse;font-size:14px;">
                            <thead><tr style="background:#f0f4f0;">
                                <th style="padding:10px;text-align:left;">Order ID</th>
                                <th style="padding:10px;text-align:left;">Date</th>
                                <th style="padding:10px;text-align:left;">Customer</th>
                                <th style="padding:10px;text-align:left;">Items</th>
                                <th style="padding:10px;text-align:right;">Total</th>
                                <th style="padding:10px;text-align:center;">Status</th>
                                <th style="padding:10px;text-align:center;">Actions</th>
                            </tr></thead>
                            <tbody id="ordersBody"><tr><td colspan="7" style="padding:30px;text-align:center;color:#999;"><i class="fas fa-spinner fa-spin"></i> Loading orders...</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ PANEL: Finance & Allocation ‚îÄ‚îÄ -->
            <div class="adm-tab-panel" id="panelFinance">

                <div id="financeLoading" style="text-align:center;padding:3rem;color:#999;"><i class="fas fa-spinner fa-spin fa-2x"></i><br><br>Loading financial data...</div>
                <div id="financeContent" style="display:none;">

                    <!-- Period Selector + Refresh -->
                    <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap;">
                        <select id="allocPeriod" class="pf-view-select" style="max-width:180px;">
                            <option value="monthly" selected>Monthly View</option>
                            <option value="weekly">Weekly View</option>
                        </select>
                        <button class="btn btn-outline-green btn-sm" id="btnRefreshFinance"><i class="fas fa-sync"></i> Refresh</button>
                        <a href="finance.html" class="btn btn-sm btn-primary" style="margin-left:auto;"><i class="fas fa-chart-pie"></i> Full Finance Dashboard</a>
                    </div>

                    <!-- ‚îÄ‚îÄ Trigger Alerts ‚îÄ‚îÄ -->
                    <div class="adm-card" style="margin-bottom:1.5rem;border-left:4px solid #E65100;">
                        <h3><i class="fas fa-bell" style="color:#E65100;"></i> Smart Trigger Alerts</h3>
                        <p style="font-size:0.82rem;color:#6b7f93;margin-bottom:1rem;">Automated financial milestones ‚Äî telling you when it's time to invest, hire, or take action.</p>
                        <div id="triggerAlerts"></div>
                    </div>

                    <!-- ‚îÄ‚îÄ Where Money Should Go ‚îÄ‚îÄ -->
                    <div class="adm-card" style="margin-bottom:1.5rem;border-left:4px solid #1565C0;">
                        <h3><i class="fas fa-university" style="color:#1565C0;"></i> Where Money Should Go ‚Äî <span id="allocPeriodLabel">This Month</span></h3>
                        <p style="font-size:0.82rem;color:#6b7f93;margin-bottom:0.5rem;">Total Revenue: <strong id="allocTotalRevenue">¬£0.00</strong> ‚Äî broken down by bank account</p>
                        <div class="bank-alloc-grid" id="bankAllocationGrid"></div>
                    </div>

                    <!-- ‚îÄ‚îÄ Full Money Breakdown ‚îÄ‚îÄ -->
                    <div class="adm-card" style="margin-bottom:1.5rem;border-left:4px solid #7B1FA2;">
                        <h3><i class="fas fa-list-alt" style="color:#7B1FA2;"></i> Full Money Breakdown</h3>
                        <p style="font-size:0.82rem;color:#6b7f93;margin-bottom:1rem;">Every pound accounted for ‚Äî where it comes from, where it goes, and which account to put it in.</p>
                        <div style="overflow-x:auto;">
                            <table class="mb-table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Amount</th>
                                        <th>Account</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="moneyBreakdownBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ‚îÄ‚îÄ Allocation Configuration ‚îÄ‚îÄ -->
                    <div class="adm-card" style="margin-bottom:1.5rem;border-left:4px solid #2E7D32;">
                        <h3><i class="fas fa-sliders-h" style="color:#2E7D32;"></i> Allocation Configuration</h3>
                        <p style="font-size:0.82rem;color:#6b7f93;margin-bottom:1rem;">Set the % of revenue that should be allocated to each fund. The remainder after all deductions is your personal pay.</p>
                        <div class="alloc-config-grid">
                            <div class="alloc-field">
                                <label>Tax Reserve %</label>
                                <input type="number" id="alloc_taxReserve" value="20" min="0" max="50" step="1">
                                <span class="alloc-hint">Income tax on profits</span>
                            </div>
                            <div class="alloc-field">
                                <label>NI Reserve %</label>
                                <input type="number" id="alloc_niReserve" value="6" min="0" max="20" step="1">
                                <span class="alloc-hint">National Insurance Class 2 + 4</span>
                            </div>
                            <div class="alloc-field">
                                <label>Emergency Fund %</label>
                                <input type="number" id="alloc_emergencyFund" value="5" min="0" max="20" step="1">
                                <span class="alloc-hint">Rainy day / 3 months cover</span>
                            </div>
                            <div class="alloc-field">
                                <label>Equipment Fund %</label>
                                <input type="number" id="alloc_equipmentFund" value="5" min="0" max="20" step="1">
                                <span class="alloc-hint">Tools, van, trailer savings</span>
                            </div>
                            <div class="alloc-field">
                                <label>Operating Float %</label>
                                <input type="number" id="alloc_operatingFloat" value="10" min="0" max="30" step="1">
                                <span class="alloc-hint">Working capital in business account</span>
                            </div>
                        </div>
                        <div style="margin-top:1rem;">
                            <button class="btn btn-primary" id="btnSaveAllocConfig"><i class="fas fa-save"></i> Save Configuration</button>
                        </div>
                    </div>

                    <!-- ‚îÄ‚îÄ Direct Debits Checklist ‚îÄ‚îÄ -->
                    <div class="adm-card" style="margin-bottom:1.5rem;border-left:4px solid #37474F;">
                        <h3><i class="fas fa-credit-card" style="color:#37474F;"></i> Direct Debits & Standing Orders</h3>
                        <p style="font-size:0.82rem;color:#6b7f93;margin-bottom:1rem;">Recommended direct debits for each bank account. Set these up to automate your financial system.</p>
                        <div class="dd-grid" id="directDebitsList"></div>
                    </div>

                    <!-- ‚îÄ‚îÄ Growth Milestones ‚îÄ‚îÄ -->
                    <div class="adm-card" style="border-left:4px solid #4CAF50;">
                        <h3><i class="fas fa-flag-checkered" style="color:#4CAF50;"></i> Growth Milestones & Investment Triggers</h3>
                        <p style="font-size:0.82rem;color:#6b7f93;margin-bottom:1rem;">When your revenue hits these levels, it's time to invest. Each milestone unlocks when both YTD and monthly targets are met.</p>
                        <div id="milestonesList"></div>
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ PANEL: Careers ‚îÄ‚îÄ -->
            <div class="adm-tab-panel" id="panelCareers">

                <!-- Post New Vacancy -->
                <div class="adm-card" style="margin-bottom:1.5rem; border-left:4px solid #1565C0;">
                    <h3 style="margin-bottom:1.25rem;"><i class="fas fa-plus-circle" style="color:#1565C0;"></i> Post New Vacancy</h3>
                    <form id="vacancyForm" style="display:grid; gap:1rem;">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Job Title <span class="required">*</span></label>
                                <input type="text" id="vacTitle" required placeholder="e.g. Groundskeeper / Gardener">
                            </div>
                            <div class="form-group">
                                <label>Employment Type</label>
                                <select id="vacType">
                                    <option value="Full-time">Full-time</option>
                                    <option value="Part-time">Part-time</option>
                                    <option value="Seasonal">Seasonal</option>
                                    <option value="Contract">Contract</option>
                                    <option value="Apprenticeship">Apprenticeship</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Location</label>
                                <input type="text" id="vacLocation" value="Cornwall" placeholder="e.g. Roche, Cornwall">
                            </div>
                            <div class="form-group">
                                <label>Salary / Rate</label>
                                <input type="text" id="vacSalary" placeholder="e.g. ¬£12.50/hr or ¬£24,000 p.a.">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description <span class="required">*</span></label>
                            <textarea id="vacDescription" rows="4" required placeholder="What the role involves, day-to-day duties, who it would suit..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Requirements</label>
                            <textarea id="vacRequirements" rows="3" placeholder="e.g. Full UK driving licence, physically fit, previous grounds maintenance experience preferred..."></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Closing Date</label>
                                <input type="date" id="vacClosingDate">
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select id="vacStatus">
                                    <option value="Open">Open</option>
                                    <option value="Closed">Closed</option>
                                    <option value="Draft">Draft</option>
                                </select>
                            </div>
                        </div>
                        <div style="display:flex; gap:0.75rem;">
                            <button type="submit" class="btn btn-primary" id="vacSubmitBtn"><i class="fas fa-paper-plane"></i> Post Vacancy</button>
                            <button type="button" class="btn btn-outline-green" id="vacClearBtn"><i class="fas fa-eraser"></i> Clear</button>
                        </div>
                    </form>
                </div>

                <!-- Active Vacancies -->
                <div class="adm-card" style="margin-bottom:1.5rem;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                        <h3 style="margin:0;"><i class="fas fa-briefcase" style="color:#2E7D32;"></i> Active Vacancies</h3>
                        <button class="btn btn-sm btn-outline-green" id="vacRefreshBtn"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                    <div id="vacLoading" style="text-align:center;padding:1.5rem;color:#999;"><i class="fas fa-spinner fa-spin"></i> Loading vacancies...</div>
                    <div id="vacList" style="display:none;"></div>
                    <div id="vacEmpty" style="display:none;text-align:center;padding:2rem;color:#999;">
                        <i class="fas fa-clipboard" style="font-size:2rem;margin-bottom:0.5rem;"></i>
                        <p>No vacancies posted yet. Create one above.</p>
                    </div>
                </div>

                <!-- Applications -->
                <div class="adm-card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                        <h3 style="margin:0;"><i class="fas fa-users" style="color:#1565C0;"></i> Job Applications</h3>
                        <div style="display:flex; gap:0.5rem;">
                            <select id="appFilterPosition" style="padding:6px 10px;border-radius:8px;border:1px solid #ddd;font-size:13px;">
                                <option value="">All Positions</option>
                            </select>
                            <select id="appFilterStatus" style="padding:6px 10px;border-radius:8px;border:1px solid #ddd;font-size:13px;">
                                <option value="">All Statuses</option>
                                <option value="New">New</option>
                                <option value="Reviewed">Reviewed</option>
                                <option value="Shortlisted">Shortlisted</option>
                                <option value="Interview">Interview</option>
                                <option value="Offered">Offered</option>
                                <option value="Rejected">Rejected</option>
                            </select>
                            <button class="btn btn-sm btn-outline-green" id="appRefreshBtn"><i class="fas fa-sync-alt"></i></button>
                        </div>
                    </div>
                    <div id="appLoading" style="text-align:center;padding:1.5rem;color:#999;"><i class="fas fa-spinner fa-spin"></i> Loading applications...</div>
                    <div id="appList" style="display:none;"></div>
                    <div id="appEmpty" style="display:none;text-align:center;padding:2rem;color:#999;">
                        <i class="fas fa-inbox" style="font-size:2rem;margin-bottom:0.5rem;"></i>
                        <p>No applications received yet.</p>
                    </div>
                </div>

                <!-- Application Detail Modal -->
                <div class="mgr-modal" id="appModal" style="display:none;">
                    <div class="mgr-modal-content" style="max-width:700px;">
                        <div class="mgr-modal-header">
                            <h3 id="appModalTitle"><i class="fas fa-user"></i> Application Details</h3>
                            <button class="mgr-modal-close" id="appModalClose">&times;</button>
                        </div>
                        <div class="mgr-modal-body" id="appModalBody" style="max-height:70vh;overflow-y:auto;"></div>
                        <div class="mgr-modal-footer" style="padding:1rem 1.5rem;border-top:1px solid #eee;display:flex;gap:0.5rem;flex-wrap:wrap;">
                            <select id="appStatusSelect" style="padding:8px 12px;border-radius:8px;border:1px solid #ddd;font-size:13px;">
                                <option value="New">New</option>
                                <option value="Reviewed">Reviewed</option>
                                <option value="Shortlisted">Shortlisted</option>
                                <option value="Interview">Interview</option>
                                <option value="Offered">Offered</option>
                                <option value="Rejected">Rejected</option>
                            </select>
                            <button class="btn btn-sm btn-primary" id="appUpdateStatusBtn"><i class="fas fa-save"></i> Update Status</button>
                            <button class="btn btn-sm btn-outline-green" id="appDownloadCVBtn"><i class="fas fa-download"></i> Download CV</button>
                            <button class="btn btn-sm" id="appEmailBtn" style="background:#1565C0;color:#fff;"><i class="fas fa-envelope"></i> Email Applicant</button>
                            <button class="btn btn-sm" id="appCallBtn" style="background:#2E7D32;color:#fff;"><i class="fas fa-phone"></i> Call</button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- ‚îÄ‚îÄ PANEL: Complaints ‚îÄ‚îÄ -->
            <div class="adm-tab-panel" id="panelComplaints">
                <h2 class="adm-panel-title"><i class="fas fa-exclamation-circle"></i> Complaints Management</h2>

                <!-- Stats Row -->
                <div class="complaints-admin-stats" id="complaintsStats"></div>

                <!-- Filters -->
                <div class="complaints-filters">
                    <select id="filterComplaintStatus">
                        <option value="">All Statuses</option>
                        <option value="open">Open</option>
                        <option value="investigating">Investigating</option>
                        <option value="resolved">Resolved</option>
                        <option value="closed">Closed</option>
                    </select>
                    <select id="filterComplaintType">
                        <option value="">All Types</option>
                        <option value="single">One-Off Jobs</option>
                        <option value="subscriber">Subscribers</option>
                    </select>
                    <select id="filterComplaintSeverity">
                        <option value="">All Severity</option>
                        <option value="minor">Minor</option>
                        <option value="moderate">Moderate</option>
                        <option value="major">Major</option>
                        <option value="critical">Critical</option>
                    </select>
                    <input type="text" id="searchComplaints" placeholder="Search name, email, ref...">
                    <button class="btn btn-sm" id="refreshComplaints"><i class="fas fa-sync"></i> Refresh</button>
                </div>

                <!-- Complaints List -->
                <div class="complaints-list" id="complaintsList">
                    <div class="adm-loading"><i class="fas fa-spinner fa-spin"></i> Loading complaints...</div>
                </div>

                <!-- Complaint Detail Modal -->
                <div class="complaint-modal-overlay" id="complaintDetailModal" style="display:none;">
                    <div class="complaint-modal">
                        <button class="complaint-modal-close" id="closeComplaintModal"><i class="fas fa-times"></i></button>
                        <div class="complaint-modal-body" id="complaintDetailBody"></div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <script src="js/admin-nav.js"></script>
    <script src="js/admin-hub.js"></script>
    <script src="js/admin-newsletter.js"></script>
    <script src="js/admin-shop.js"></script>
    <script src="js/admin-finance.js"></script>
    <script src="js/admin-careers.js"></script>
    <script src="js/admin-complaints.js"></script>
</body>
</html>
